<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="|${pageName}|"></title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <style>
        .movie-list {
            display: flex;
            overflow-x: hidden;
            padding: 10px;
            gap: 10px;
            position: relative;
        }
        .movie-item {
            flex: 0 0 auto;
            width: 150px;
            text-align: center;
            position: relative;
        }
        .movie-item img {
            cursor: pointer;
            width: 100%;
        }
        .movie-info {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            box-sizing: border-box;
        }
        .movie-info p {
            margin: 5px 0;
        }
        .arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
        }
        .arrow.left {
            left: 0;
        }
        .arrow.right {
            right: 0;
        }
    </style>
</head>

<body>
<div class="container">
    <div th:replace="fragments/bodyHeader :: bodyHeader" />
    <div class="jumbotron">
        <a th:href="@{/oauth2/authorization/google}" class="btn btn-primary me-2 active" role="button">Google Login</a>

        <h1><a th:href="|/${loginType}/home|">[[${pageName}]]</a></h1> <hr/>

        <form th:action="@{/jwt-login/search}" method="get">
            <input type="text" name="query" placeholder="영화 검색">
            <button type="submit">검색</button>
        </form>

        <div th:if="${popularMovies}">
            <h2 class="category-title">인기 영화</h2>
            <button class="arrow left" onclick="scrollContainer(-1)">&#9664;</button>
            <div class="movie-list" id="popularMovieList"></div>
            <button class="arrow right" onclick="scrollContainer(1)">&#9654;</button>
            <script th:inline="javascript">
                /*<![CDATA[*/
                var popularMovies = /*[[${popularMovies}]]*/ '[]';
                var popularMovieList = JSON.parse(popularMovies).results;
                var popularMovieListContainer = document.getElementById('popularMovieList');

                popularMovieList.forEach(function(movie) {
                  var li = document.createElement('li');
                  li.classList.add('movie-item');

                  var h3 = document.createElement('h3');
                  h3.textContent = movie.title;

                  var img = document.createElement('img');
                  img.src = 'https://image.tmdb.org/t/p/w500' + movie.poster_path;
                  img.alt = movie.title;
                  img.addEventListener('click', function() {
                      window.location.href = '/jwt-login/contents/' + movie.id; // 디테일 페이지로 이동
<!--                    var overview = li.querySelector('.movie-info');-->
<!--                    overview.style.display = (overview.style.display === "none" || !overview.style.display) ? "block" : "none";-->
                  });

                  var infoDiv = document.createElement('div');
                  infoDiv.classList.add('movie-info');
                  infoDiv.addEventListener('click', function() {
                    infoDiv.style.display = "none";
                  });

                  var pRating = document.createElement('p');
                  pRating.textContent = '평균 평점: ' + movie.vote_average;

                  var pReleaseDate = document.createElement('p');
                  pReleaseDate.textContent = '개봉일: ' + movie.release_date;

                  var pOverview = document.createElement('p');
                  pOverview.textContent = movie.overview;

                  infoDiv.appendChild(pRating);
                  infoDiv.appendChild(pReleaseDate);
                  infoDiv.appendChild(pOverview);

                  li.appendChild(h3);
                  li.appendChild(img);
                  li.appendChild(infoDiv);
                  popularMovieListContainer.appendChild(li);
                });

                function scrollContainer(direction) {
                    const container = document.getElementById('popularMovieList');
                    const scrollAmount = 170; // 포스터의 너비 + 마진
                    container.scrollBy({
                        left: direction * scrollAmount,
                        behavior: 'smooth'
                    });
                }

                /*]]>*/
            </script>
        </div>

        <div th:if="${trendingMovies}">
            <h2 class="category-title">트렌딩 영화</h2>
            <button class="arrow left" onclick="scrollContainer(-1)">&#9664;</button>
            <div class="movie-list" id="trendingMovieList"></div>
            <button class="arrow right" onclick="scrollContainer(1)">&#9654;</button>
            <script th:inline="javascript">
                /*<![CDATA[*/
                var trendingMovies = /*[[${trendingMovies}]]*/ '[]';
                var trendingMovieList = JSON.parse(trendingMovies).results;
                var trendingMovieListContainer = document.getElementById('trendingMovieList');

                trendingMovieList.forEach(function(movie) {
                  var li = document.createElement('li');
                  li.classList.add('movie-item');

                  var h3 = document.createElement('h3');
                  h3.textContent = movie.title;

                  var img = document.createElement('img');
                  img.src = 'https://image.tmdb.org/t/p/w500' + movie.poster_path;
                  img.alt = movie.title;
                  img.addEventListener('click', function() {
                    window.location.href = '/jwt-login/contents/' + movie.id; // 디테일 페이지로 이동

<!--                    var overview = li.querySelector('.movie-info');-->
<!--                    overview.style.display = (overview.style.display === "none" || !overview.style.display) ? "block" : "none";-->
                  });

                  var infoDiv = document.createElement('div');
                  infoDiv.classList.add('movie-info');
                  infoDiv.addEventListener('click', function() {
                    infoDiv.style.display = "none";
                  });

                  var pRating = document.createElement('p');
                  pRating.textContent = '평균 평점: ' + movie.vote_average;

                  var pReleaseDate = document.createElement('p');
                  pReleaseDate.textContent = '개봉일: ' + movie.release_date;

                  var pOverview = document.createElement('p');
                  pOverview.textContent = movie.overview;

                  infoDiv.appendChild(pRating);
                  infoDiv.appendChild(pReleaseDate);
                  infoDiv.appendChild(pOverview);

                  li.appendChild(h3);
                  li.appendChild(img);
                  li.appendChild(infoDiv);
                  trendingMovieListContainer.appendChild(li);
                });

                function scrollContainer(direction) {
                    const container = document.getElementById('trendingMovieList');
                    const scrollAmount = 170; // 포스터의 너비 + 마진
                    container.scrollBy({
                        left: direction * scrollAmount,
                        behavior: 'smooth'
                    });
                }

                /*]]>*/
            </script>
        </div>


<!--    <div th:if="${nickname == null}">-->
    <div th:if="${#authentication.name == 'anonymousUser'}">
        <h3>로그인 되어있지 않습니다!</h3>
        <button th:onclick="|location.href='@{/{loginType}/join (loginType=${loginType})}'|">회원 가입</button> <br/><br/>
        <button th:onclick="|location.href='@{/{loginType}/login (loginType=${loginType})}'|">로그인</button>
    </div>
<!--    <div th:unless="${nickname == null}">-->
    <div th:if="${#authentication.name != 'anonymousUser'}">
      <h3>[[${#authentication.name}]]님 환영합니다!</h3>
      <button th:onclick="|location.href='@{/info}'|">유저 정보</button> <br/><br/>
      <button th:onclick="|location.href='@{/{loginType}/admin (loginType=${loginType})}'|">관리자 페이지</button> <br/><br/>
      <button th:onclick="|location.href='@{/{loginType}/logout (loginType=${loginType})}'|">로그아웃</button>
    </div>

    <p>
      <a class="btn btn-lg btn-info" href="/notice">공지 게시판</a>
      <a class="btn btn-lg btn-info" href="/reviews">리뷰 게시판</a>
      <a class="btn btn-lg btn-info" href="/reviews">자유 게시판</a>
      <a class="btn btn-lg btn-info" href="/reviews">BEFORE SCENE 게시판</a>
      <a class="btn btn-lg btn-info" href="/reviews">AFTER SCENE 게시판</a>
      <a class="btn btn-lg btn-info" href="/additional-info">개인 정보</a>
    </p>

    <p class="lead"></p>
  </div>
  <div th:replace="fragments/footer :: footer" />
</div> <!-- /container -->
</body>
</html>
